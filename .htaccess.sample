# =====================================================
# .htaccess — 봇이면 index.html, 아니면 redirect.html
# Apache 2.4.64 (Amazon Linux)
# =====================================================

RewriteEngine On

# (선택) Client Hints 요청 — 필요 없으면 주석 처리 가능
Header set Accept-CH "Sec-CH-UA, Sec-CH-UA-Platform, Sec-CH-UA-Mobile"
Header set Permissions-Policy "ch-ua=(self), ch-ua-mobile=(self), ch-ua-platform=(self)"

# (선택) 캐시 분리 — 이 시나리오에선 없어도 됨
# Header merge Vary "User-Agent"
# Header merge Vary "Sec-CH-UA, Sec-CH-UA-Platform, Sec-CH-UA-Mobile"

# --- UA 태깅
SetEnvIfNoCase User-Agent "(Googlebot|Bingbot|DuckDuckBot|YandexBot|baiduspider|SemrushBot)" IS_BOT=1
# (선택) Client Hints 폴백
# SetEnvIfNoCase SEC-CH-UA-MOBILE "^\?1$" IS_MOBILE=1

# --- 정적/실존 경로는 통과 (중요)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule - - [L]

# --- 필요시 예외 추가 (.well-known, api 등)
# RewriteRule ^\.well-known/ - [L]
# RewriteRule ^api/ - [L]

# --- 봇이면 index.html
RewriteCond %{ENV:IS_BOT} =1
RewriteRule ^$ index.html [L]
RewriteCond %{ENV:IS_BOT} =1
RewriteRule ^ index.html [L]

# --- 비봇이면 redirect.html
RewriteCond %{ENV:IS_BOT} !=1
RewriteRule ^$ redirect.html [L]
RewriteCond %{ENV:IS_BOT} !=1
RewriteRule ^ redirect.html [L]